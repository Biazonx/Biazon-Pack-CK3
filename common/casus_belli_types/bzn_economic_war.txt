cb_coffee_raid = {
	icon = coffee
	group = war_of_humiliation

	combine_into_one = yes
	should_show_war_goal_subview = yes

	allowed_for_character = {
	}

	allowed_against_character = {
		scope:attacker = {
			ALL_FALSE = {
				top_liege = scope:defender.top_liege
				liege = scope:defender
			}
		}
		scope:defender = { 
			any_held_title = {
			tier = tier_county
			title_province = { geographical_region = custom_coffee }
			}
			NOT = { has_character_modifier = stolen_coffee }
		}
	}
	
	valid_to_start = {
		# No specific conditions to allow free use
	}

	on_declaration = {
		on_declared_war = yes
	}

	cost = {
		prestige = {
			value = 25
			add = {
				value = 5
				multiply = scope:defender.realm_size
				desc = "Additional prestige cost for larger defender"
			}
		}
	}

	on_victory_desc = {
		desc = "cb_coffee_raid_victory_desc"
	}

	on_victory = {
	scope:defender = {
		pay_short_term_income = { years = 1 target = scope:attacker }
		add_legitimacy = -100 
		add_character_modifier = {
			modifier = stolen_coffee
			years = 3
		}
	}
	
	scope:attacker = {
		show_pow_release_message_effect = yes
		add_legitimacy = 100
		add_character_modifier = {
			modifier = seized_coffee
			years = 3
		}
	}
	modify_allies_of_participants_fame_values = {
		WINNER = scope:attacker
		LOSER = scope:defender
		FAME_BASE = 50
		IS_RELIGIOUS_WAR = no
		WINNER_FAME_SCALE = 1
		LOSER_FAME_SCALE = -1
		WINNER_ALLY_FAME_SCALE = 1
		LOSER_ALLY_FAME_SCALE = 1
	}
	add_truce_attacker_victory_effect = yes
	}

	on_defeat_desc = {
		desc = "cb_coffee_raid_defeat_desc"
	}
	
	on_white_peace = {
		scope:attacker = { show_pow_release_message_effect = yes }
		# Prestige loss for the attacker
		scope:attacker = {
			add_prestige = {
				value = minor_prestige_value
				multiply = -1.0
			}
			stress_impact = {
 				ambitious = medium_stress_impact_gain
 				arrogant = medium_stress_impact_gain
 			}
		}

		# Allies on both sides get full prestige value for helping in the war, based on their war participation.
		modify_allies_of_participants_fame_values = {
			WINNER = scope:attacker # Not important as the scales are identical
			FAME_BASE = minor_prestige_value
			IS_RELIGIOUS_WAR = no
			WINNER_ALLY_FAME_SCALE = 1
			LOSER_ALLY_FAME_SCALE = 1
		}

		scope:defender = {
			stress_impact = {
 				arrogant = medium_stress_impact_gain
 			}
		}

		add_truce_white_peace_effect = yes

		# EP3: note gold gained from military assistance/join war contracts and their war contribution threshold
		laamp_as_mercenary_payout_tooltip_effect = yes
	}
	
	on_defeat = {
		scope:attacker = {
			show_pow_release_message_effect = yes
			add_legitimacy = -50
			add_prestige = -100
			pay_short_term_income = { years = 1 target = scope:defender }
		}
		scope:defender = {
			add_legitimacy = 50
			add_prestige = 100
		}
		modify_allies_of_participants_fame_values = {
			WINNER = scope:defender
			LOSER = scope:attacker
			FAME_BASE = 50
			IS_RELIGIOUS_WAR = no
			WINNER_FAME_SCALE = 1
			LOSER_FAME_SCALE = -1
			WINNER_ALLY_FAME_SCALE = 1
			LOSER_ALLY_FAME_SCALE = 1
		}
		add_truce_attacker_defeat_effect = yes
	}

	on_invalidated_desc = {
		desc = "cb_coffee_raid_invalidated_desc"
	}

	on_invalidated = {
		# Define invalidated actions if any
	}
	
	ai_score_mult = {
		value = 10
	}

	on_primary_attacker_death = inherit
	on_primary_defender_death = inherit

	transfer_behavior = transfer

	attacker_allies_inherit = yes
	defender_allies_inherit = yes

	war_name = "Seize Coffee Production"
	cb_name_no_target = "Seize Coffee Production"

	interface_priority = 1005

	attacker_wargoal_percentage = 0.8

	should_show_war_goal_subview = yes
}

cb_coffee_labor = {
	icon = coffee
	group = war_of_humiliation

	combine_into_one = yes
	should_show_war_goal_subview = yes

	allowed_for_character = {
		scope:attacker = {
			any_held_title = {
				tier = tier_county
				title_province = { geographical_region = custom_coffee }
			}
		}
	}

	allowed_against_character = {
		scope:attacker = {
			ALL_FALSE = {
				top_liege = scope:defender.top_liege
				liege = scope:defender
			}
		}
	}

	valid_to_start = { }

	cost = {
		prestige = {
			value = 25
			add = {
				value = 5
				multiply = scope:defender.realm_size
				desc = "Additional prestige cost for larger defender"
			}
		}
	}

	on_victory_desc = {
		desc = "cb_coffee_labor_victory_desc"
	}
	
	on_victory = {
		# Attacker gains labor boost
		scope:attacker = {
			add_character_modifier = {
				modifier = imported_coffee_labor
				years = 10
			}
			add_legitimacy = 100
		}

		# Defender loses development (represents population drain)
		scope:defender = {
			random_realm_county = {
				change_development_level = -1
			}
			add_legitimacy = -100
			pay_short_term_income = { years = 1 target = scope:attacker }
		}
	modify_allies_of_participants_fame_values = {
		WINNER = scope:attacker
		LOSER = scope:defender
		FAME_BASE = 50
		IS_RELIGIOUS_WAR = no
		WINNER_FAME_SCALE = 1
		LOSER_FAME_SCALE = -1
		WINNER_ALLY_FAME_SCALE = 1
		LOSER_ALLY_FAME_SCALE = 1
	}
	add_truce_attacker_victory_effect = yes
	}
	
	on_white_peace = {
		scope:attacker = { show_pow_release_message_effect = yes }
		# Prestige loss for the attacker
		scope:attacker = {
			add_prestige = {
				value = minor_prestige_value
				multiply = -1.0
			}
			stress_impact = {
 				ambitious = medium_stress_impact_gain
 				arrogant = medium_stress_impact_gain
 			}
		}

		# Allies on both sides get full prestige value for helping in the war, based on their war participation.
		modify_allies_of_participants_fame_values = {
			WINNER = scope:attacker # Not important as the scales are identical
			FAME_BASE = minor_prestige_value
			IS_RELIGIOUS_WAR = no
			WINNER_ALLY_FAME_SCALE = 1
			LOSER_ALLY_FAME_SCALE = 1
		}

		scope:defender = {
			stress_impact = {
 				arrogant = medium_stress_impact_gain
 			}
		}

		add_truce_white_peace_effect = yes

		# EP3: note gold gained from military assistance/join war contracts and their war contribution threshold
		laamp_as_mercenary_payout_tooltip_effect = yes
	}
	
	on_defeat_desc = {
		desc = "cb_coffee_labor_defeat_desc"
	}
	
	on_defeat = {
		scope:attacker = {
			show_pow_release_message_effect = yes
			add_legitimacy = -50
			add_prestige = -100
			pay_short_term_income = { years = 1 target = scope:defender }
		}
		scope:defender = {
			add_legitimacy = 50
			add_prestige = 100
		}
		modify_allies_of_participants_fame_values = {
			WINNER = scope:defender
			LOSER = scope:attacker
			FAME_BASE = 50
			IS_RELIGIOUS_WAR = no
			WINNER_FAME_SCALE = 1
			LOSER_FAME_SCALE = -1
			WINNER_ALLY_FAME_SCALE = 1
			LOSER_ALLY_FAME_SCALE = 1
		}
		add_truce_attacker_defeat_effect = yes
	}
	
	on_invalidated_desc = {
		desc = "cb_coffee_labor_invalidated_desc"
	}
	
	ai_score_mult = {
		value = 10
	}

	on_primary_attacker_death = inherit
	on_primary_defender_death = inherit

	transfer_behavior = transfer

	attacker_allies_inherit = yes
	defender_allies_inherit = yes

	war_name = "Enforce Coffee Labor"
	cb_name_no_target = "Enforce Coffee Labor"

	interface_priority = 1006
	attacker_wargoal_percentage = 0.8
}