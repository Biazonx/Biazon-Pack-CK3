# a decision to mass demand conversion from different type of people. This is just a shortcut for starting this interaction for each of them manually.
# (thanks "MrFunEGUY" for the code check of "religiously_protected")

# game update 24.9.2024 notes for decisions: 
# picture = "..." changed to picture = {reference = "..."}
# and decision_group_type was added (optional, see common\decision_group_types for valid groups)

mod_mass_convert_subjects_decision = {
  picture = {
      reference = "gfx/interface/illustrations/decisions/decision_personal_religious.dds"
  }
	desc = mod_mass_convert_subjects_decision_desc
  decision_group_type = admin
    is_shown = { 
        OR = {
            any_vassal = {
                NOT = { vassal_contract_has_flag = religiously_protected }
                root = {
                    is_character_interaction_potentially_accepted = {
                        recipient = prev
                        interaction = demand_conversion_vassal_ruler_interaction
                    }
                }
            }
            any_vassal_or_below = {
                NOT = { vassal_contract_has_flag = religiously_protected }
                exists = liege
                NOT = {
                    liege = root # filter for indirect vassals, so ones we are not the liege of
                }
                root = {
                    is_character_interaction_potentially_accepted = {
                        recipient = prev
                        interaction = demand_conversion_vassal_ruler_interaction
                    }
                }
            }
            any_tributary = {
                root = {
                    is_character_interaction_potentially_accepted = {
                        recipient = prev
                        interaction = demand_conversion_vassal_ruler_interaction
                    }
                }
            }
            any_courtier = {
                root = {
                    is_character_interaction_potentially_accepted = {
                        recipient = prev
                        interaction = ask_for_conversion_courtier_interaction
                    }
                }
            }
            AND = {
                exists = house
                house = {
                    any_house_member = {
                        root = {
                            is_character_interaction_potentially_accepted = {
                                recipient = prev
                                interaction = demand_conversion_interaction
                            }
                        }
                    }
                }
            }
        }
    }
 
  widget = {
		gui = "decision_view_widget_decision_option_list_controller"
		controller = decision_option_list_controller
 
		item = {
			value = mod_convert_direct_vassals
			localization = mod_convert_direct_vassals_loc
			ai_chance = { value = 0 } # unused
		}
		item = {
			value = mod_convert_indirect_vassals
			localization = mod_convert_indirect_vassals_loc
			ai_chance = { value = 0 } # unused
		}
        item = {
            value = mod_convert_tributaries
            localization = mod_convert_tributaries_loc
            ai_chance = { value = 0 } # unused
        }
		item = {
			value = mod_convert_courtiers
			localization = mod_convert_courtiers_loc
			ai_chance = { value = 0 } # unused
		}
        item = {
			value = mod_convert_house
			localization = mod_convert_house_loc
			ai_chance = { value = 0 } # unused
		}
 
	}
 
 
	effect = {
 
        if = {
			limit = { scope:mod_convert_direct_vassals = yes }
			every_vassal = { # direct vassals
                limit = { NOT = { vassal_contract_has_flag = religiously_protected } }
                if = {
                    limit = {
                        root = {
                            is_character_interaction_potentially_accepted = {
                                recipient = prev
                                interaction = demand_conversion_vassal_ruler_interaction
                            }
                        }
                    }
                    run_interaction = {
                        interaction = demand_conversion_vassal_ruler_interaction
                        actor = root
                        recipient = this
                        # execute_threshold = decline # does what is written in on_accept, so everyone would accept this way
                        send_threshold = decline # send the request and then AI will decide like normal 
                    }
                }
            }
		}
		else_if = {
			limit = { scope:mod_convert_indirect_vassals = yes }
			every_vassal_or_below = { # all vassals
                limit = { NOT = { vassal_contract_has_flag = religiously_protected } }
                if = {
                    limit = {
                        exists = liege
                        NOT = {
                            liege = root # filter for indirect vassals, so ones we are not the liege of
                        }
                        root = {
                            is_character_interaction_potentially_accepted = {
                                recipient = prev
                                interaction = demand_conversion_vassal_ruler_interaction
                            }
                        }
                    }
                    run_interaction = {
                        interaction = demand_conversion_vassal_ruler_interaction
                        actor = root
                        recipient = this
                        send_threshold = decline # send the request and then AI will decide like normal 
                    }
                }
            }
		}
        else_if = {
            limit = { scope:mod_convert_tributaries = yes }
            every_tributary = {
                if = {
                    limit = {
                        root = {
                            is_character_interaction_potentially_accepted = {
                                recipient = prev
                                interaction = demand_conversion_vassal_ruler_interaction
                            }
                        }
                    }
                    run_interaction = {
                        interaction = demand_conversion_vassal_ruler_interaction
                        actor = root
                        recipient = this
                        send_threshold = decline # send the request and then AI will decide like normal 
                    }
                }
            }
        }
		else_if = {
			limit = { scope:mod_convert_courtiers = yes }
			every_courtier = {
                if = {
                    limit = {
                        root = {
                            is_character_interaction_potentially_accepted = {
                                recipient = prev
                                interaction = ask_for_conversion_courtier_interaction
                            }
                        }
                    }
                    run_interaction = {
                        interaction = ask_for_conversion_courtier_interaction
                        actor = root
                        recipient = this
                        send_threshold = decline # send the request and then AI will decide like normal 
                    }
                }
            }
		}
        else_if = {
			limit = { scope:mod_convert_house = yes }
			if = {
                limit = {
                    exists = house
                }
                house = {
                    every_house_member = {
                        if = {
                            limit = {
                                root = {
                                    is_character_interaction_potentially_accepted = {
                                        recipient = prev
                                        interaction = demand_conversion_interaction
                                    }
                                }
                            }
                            run_interaction = {
                                interaction = demand_conversion_interaction
                                actor = root
                                recipient = this
                                send_threshold = decline # send the request and then AI will decide like normal 
                            }
                        }
                    }
                }
            }
		}
 
 
 
    }
 
 
	ai_will_do = {
		base = 0 #The AI should never do this!
	}
    ai_check_interval = 0
}

mass_directive_decisions = { 
	picture = {
		reference = "gfx/interface/illustrations/decisions/fp2_decision_struggle_compromise.dds"
	}
	desc = mass_directive_decisions
	confirm_text = mass_directive_decisions_confirm
	selection_tooltip = mass_directive_decisions_tooltip
	decision_group_type = decisions
	
	is_shown = {
		any_vassal = {
			# is_vassal_of = scope:actor
			is_landed = yes
			highest_held_title_tier >= tier_county
			is_ai = yes
		}
	}
	
	is_valid_showing_failures_only = { }
	
	widget = {
		gui = "decision_view_widget_decision_option_list_controller"
		controller = decision_option_list_controller
 
		item = {
			value = mod_improve_development	
			current_description = mod_improve_development_tooltip
			localization = mod_new_decision_improve_development
		}
		item = {
			value = mod_train_commanders
			current_description = mod_new_train_commanders_tooltip
			localization = mod_new_decision_train_commanders
		}
		item = {
			value = mod_build_maa	
			current_description = mod_build_maa_tooltip
			localization = mod_new_decision_build_maa
		}	
        item = {
			value = mod_convert_faith
			current_description = mod_convert_faith_tooltip
			localization = mod_new_decision_convert_faith
		}
		item = {
			value = mod_convert_culture	
			current_description = mod_convert_culture_tooltip
			localization = mod_new_decision_convert_culture
		}
		item = {
			value = mod_improve_cultural_acceptance	
			current_description = mod_improve_cultural_acceptance_tooltip
			localization = mod_new_decision_improve_cultural_acceptance
		}
		item = {
			value = mod_building_focus_fortification	
			current_description = mod_building_focus_fortification_tooltip
			localization = mod_new_decision_building_focus_fortification
		}
		item = {
			value = mod_building_focus_military	
			current_description = mod_building_focus_military_tooltip
			localization = mod_new_decision_building_focus_military
		}
		item = {
			value = mod_building_focus_economy
			current_description = mod_building_focus_economy_tooltip
			localization = mod_new_decision_building_focus_economy
		}
		item = {
			value = mod_remove_directive	
			current_description = mod_remove_directive_tooltip
			localization = mod_new_decision_remove_directive
		}
	}
 
	effect = {
		every_vassal = {
			limit = { highest_held_title_tier >= tier_county }
			# current_description = { }
			custom_tooltip = { }
			switch = {
				trigger = yes
				
				scope:mod_improve_development ?= {
					if = {
						limit = {
							highest_held_title_tier >= tier_duchy
						}
						custom_tooltip = mod_new_decision_improve_development_tooltip
						remove_vassal_directives = yes
						add_character_flag = vassal_directive_improve_development
					}
				}
				
				scope:mod_train_commanders ?= {
					remove_vassal_directives = yes
					custom_tooltip = mod_new_decision_train_commanders_tooltip
					add_character_flag = vassal_directive_train_commanders
				}
			
				scope:mod_build_maa ?= {
					custom_tooltip = mod_new_decision_build_maa_tooltip
					remove_vassal_directives = yes
					add_character_flag = vassal_directive_build_maa
				}
				
				scope:mod_convert_faith ?= {
					remove_vassal_directives = yes
					custom_tooltip = mod_new_decision_convert_faith_tooltip
					add_character_flag = vassal_directive_convert_faith
				}
				
				scope:mod_convert_culture ?= {
					remove_vassal_directives = yes
					custom_tooltip = mod_new_decision_convert_culture_tooltip
					add_character_flag = vassal_directive_convert_culture
				}
				
				scope:mod_improve_cultural_acceptance ?= {
					if = {
						limit = {
							highest_held_title_tier >= tier_duchy
						}
					remove_vassal_directives = yes
					custom_tooltip = mod_improve_cultural_acceptance_tooltip
					add_character_flag = vassal_directive_improve_cultural_acceptance
					}
				}
				
				scope:mod_building_focus_fortification ?= {
					remove_vassal_directives = yes
					custom_tooltip = mod_new_decision_building_focus_fortification_tooltip			
					add_character_flag = vassal_directive_building_focus_fortification
				}
				
				scope:mod_building_focus_military ?= {
					remove_vassal_directives = yes
					custom_tooltip = mod_new_decision_building_focus_military_tooltip
					add_character_flag = vassal_directive_building_focus_military
				}
				
				scope:mod_building_focus_economy ?= {
					remove_vassal_directives = yes
					custom_tooltip = mod_new_decision_building_focus_economy_tooltip		
					add_character_flag = vassal_directive_building_focus_economy
				}
				
				scope:mod_remove_directive ?= {
					custom_tooltip = mod_new_decision_remove_directive_tooltip
					remove_vassal_directives = yes
				}
			}
		}
	}

    # The AI should never do this!
	ai_will_do = { base = 0 }
    ai_check_interval = 0
	ai_check_interval_by_tier = {
		barony = 0
		county = 0
		duchy = 0
		kingdom = 0
		empire = 0
		hegemony = 0
	}
}

mdo_demand_obedience_decion = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/mpo_decision_great_khan.dds"
	}
	decision_group_type = nomad_major
	sort_order = 80

	is_shown = {
		is_ai = no
		government_allows = obedience
		OR = {
			any_courtier = {
				obedience_target ?= root
				is_obedient = no
				ROOT = {
					is_character_interaction_valid = {
						interaction = mpo_demand_obedience_interaction
						recipient = prev
					}
					is_character_interaction_potentially_accepted = {
						interaction = mpo_demand_obedience_interaction
						recipient = prev
					}
					NOT = { is_at_war_with = prev }
				}
			}
			any_vassal = {
				obedience_target ?= root
				is_obedient = no
				ROOT = {
					is_character_interaction_valid = {
						interaction = mpo_demand_obedience_interaction
						recipient = prev
					}
					is_character_interaction_potentially_accepted = {
						interaction = mpo_demand_obedience_interaction
						recipient = prev
					}
					NOT = { is_at_war_with = prev }
				}
			}
			any_tributary = { 
				obedience_target ?= root
				is_obedient = no
				ROOT = {
					is_character_interaction_valid = {
						interaction = mpo_demand_obedience_interaction
						recipient = prev
					}
					is_character_interaction_potentially_accepted = {
						interaction = mpo_demand_obedience_interaction
						recipient = prev
					}
					NOT = { is_at_war_with = prev }
				}
			}
		}
	}

	is_valid = {
		age >= 16
		is_physically_able = yes
		dread >= medium_dread_value
	}

	widget = {
		gui = "decision_view_widget_option_list_generic"
		controller = decision_option_list_controller
		decision_to_second_step_button = "GENERIC_CHOOSE_OPTION"

		item = {
			value = mdo_courtier_accept
			is_shown = {
				any_courtier = {
					obedience_target ?= root
					is_obedient = no
					ROOT = {
						is_character_interaction_valid = {
							interaction = mpo_demand_obedience_interaction
							recipient = prev
						}
						is_character_interaction_potentially_accepted = {
							interaction = mpo_demand_obedience_interaction
							recipient = prev
							required_response = yes
						}
						NOT = { is_at_war_with = prev }
					}
				}
			}
			icon = "gfx/interface/icons/message_feed/courtier.dds"
			current_description = MDO_COURTIER_ACCEPT
			localization = MDO_COURTIER_ACCEPT
		}
		item = {
			value = mdo_vassal_accept
			is_shown = {
				any_vassal = {
					obedience_target ?= root
					is_obedient = no
					ROOT = {
						is_character_interaction_valid = {
							interaction = mpo_demand_obedience_interaction
							recipient = prev
						}
						is_character_interaction_potentially_accepted = {
							interaction = mpo_demand_obedience_interaction
							recipient = prev
							required_response = yes
						}
						NOT = { is_at_war_with = prev }
					}
				}
			}
			icon = "gfx/interface/icons/message_feed/vassal.dds"
			current_description = MDO_VASSAL_ACCEPT
			localization = MDO_VASSAL_ACCEPT
		}
		item = {
			value = mdo_tributary_accept
			is_shown = {
				any_tributary = {
					obedience_target ?= root
					is_obedient = no
					ROOT = {
						is_character_interaction_valid = {
							interaction = mpo_demand_obedience_interaction
							recipient = prev
						}
						is_character_interaction_potentially_accepted = {
							interaction = mpo_demand_obedience_interaction
							recipient = prev
							required_response = yes
						}
						NOT = { is_at_war_with = prev }
					}
				}
			}
			icon = "gfx/interface/icons/message_feed/tributary.dds"
			current_description = MDO_TRIBUTARY_ACCEPT
			localization = MDO_TRIBUTARY_ACCEPT
		}
		item = {
			value = mdo_courtier_maybe
			is_shown = {
				any_courtier = {
					obedience_target ?= root
					is_obedient = no
					ROOT = {
						is_character_interaction_valid = {
							interaction = mpo_demand_obedience_interaction
							recipient = prev
						}
						is_character_interaction_potentially_accepted = {
							interaction = mpo_demand_obedience_interaction
							recipient = prev
							required_response = maybe
						}
						NOT = { is_at_war_with = prev }
					}
				}
			}
			icon = "gfx/interface/icons/message_feed/courtier.dds"
			current_description = MDO_COURTIER_MAYBE
			localization = MDO_COURTIER_MAYBE
		}
		item = {
			value = mdo_vassal_maybe
			is_shown = {
				any_vassal = {
					obedience_target ?= root
					is_obedient = no
					ROOT = {
						is_character_interaction_valid = {
							interaction = mpo_demand_obedience_interaction
							recipient = prev
						}
						is_character_interaction_potentially_accepted = {
							interaction = mpo_demand_obedience_interaction
							recipient = prev
							required_response = maybe
						}
						NOT = { is_at_war_with = prev }
					}
				}
			}
			icon = "gfx/interface/icons/message_feed/vassal.dds"
			current_description = MDO_VASSAL_MAYBE
			localization = MDO_VASSAL_MAYBE
		}
		item = {
			value = mdo_tributary_maybe
			is_shown = {
				any_tributary = {
					obedience_target ?= root
					is_obedient = no
					ROOT = {
						is_character_interaction_valid = {
							interaction = mpo_demand_obedience_interaction
							recipient = prev
						}
						is_character_interaction_potentially_accepted = {
							interaction = mpo_demand_obedience_interaction
							recipient = prev
							required_response = maybe
						}
						NOT = { is_at_war_with = prev }
					}
				}
			}
			icon = "gfx/interface/icons/message_feed/tributary.dds"
			current_description = MDO_TRIBUTARY_MAYBE
			localization = MDO_TRIBUTARY_MAYBE
		}
	}

	effect = {
		if = {
			limit = {
				scope:mdo_courtier_maybe ?= yes
			}
			every_courtier = {
				limit = {
					obedience_target ?= root
					is_obedient = no
					NOT = { is_at_war_with = prev }
				}
				custom_tooltip = mdo_demand_obedience_decion_sent
				run_interaction = {
					interaction = mpo_demand_obedience_interaction
					actor = root
					recipient = this
					send_threshold = maybe
				}
			}
			show_as_tooltip = {
				add_prestige = {
					value = {
						value = minor_prestige_loss
						every_courtier = {
							limit = {
								obedience_target ?= root
								is_obedient = no
								ROOT = {
									is_character_interaction_potentially_accepted = {
										interaction = mpo_demand_obedience_interaction
										recipient = prev
									}
									NOT = { is_at_war_with = prev }
								}
							}
							add = 1
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				scope:mdo_courtier_accept ?= yes
			}
			every_courtier = {
				limit = {
					obedience_target ?= root
					is_obedient = no
					NOT = { is_at_war_with = prev }
				}
				custom_tooltip = mdo_demand_obedience_decion_sent
				run_interaction = {
					interaction = mpo_demand_obedience_interaction
					actor = root
					recipient = this
					send_threshold = accept
				}
			}
			show_as_tooltip = {
				add_prestige = {
					value = {
						value = minor_prestige_loss
						every_courtier = {
							limit = {
								obedience_target ?= root
								is_obedient = no
								ROOT = {
									is_character_interaction_potentially_accepted = {
										interaction = mpo_demand_obedience_interaction
										recipient = prev
										required_response = yes
									}
									NOT = { is_at_war_with = prev }
								}
							}
							add = 1
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				scope:mdo_vassal_maybe ?= yes
			}
			every_vassal = {
				limit = {
					obedience_target ?= root
					is_obedient = no
					NOT = { is_at_war_with = prev }
				}
				custom_tooltip = mdo_demand_obedience_decion_sent
				run_interaction = {
					interaction = mpo_demand_obedience_interaction
					actor = root
					recipient = this
					send_threshold = maybe
				}
			}
			show_as_tooltip = {
				add_prestige = {
					value = {
						value = minor_prestige_loss
						every_vassal = {
							limit = {
								obedience_target ?= root
								is_obedient = no
								ROOT = {
									is_character_interaction_potentially_accepted = {
										interaction = mpo_demand_obedience_interaction
										recipient = prev
									}
									NOT = { is_at_war_with = prev }
								}
							}
							add = 1
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				scope:mdo_vassal_accept ?= yes
			}
			every_vassal = {
				limit = {
					obedience_target ?= root
					is_obedient = no
					NOT = { is_at_war_with = prev }
				}
				custom_tooltip = mdo_demand_obedience_decion_sent
				run_interaction = {
					interaction = mpo_demand_obedience_interaction
					actor = root
					recipient = this
					send_threshold = accept
				}
			}
			show_as_tooltip = {
				add_prestige = {
					value = {
						value = minor_prestige_loss
						every_vassal = {
							limit = {
								obedience_target ?= root
								is_obedient = no
								ROOT = {
									is_character_interaction_potentially_accepted = {
										interaction = mpo_demand_obedience_interaction
										recipient = prev
										required_response = yes
									}
									NOT = { is_at_war_with = prev }
								}
							}
							add = 1
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				scope:mdo_tributary_maybe ?= yes
			}
			every_tributary = {
				limit = {
					obedience_target ?= root
					is_obedient = no
					NOT = { is_at_war_with = prev }
				}
				custom_tooltip = mdo_demand_obedience_decion_sent
				run_interaction = {
					interaction = mpo_demand_obedience_interaction
					actor = root
					recipient = this
					send_threshold = maybe
				}
			}
			show_as_tooltip = {
				add_prestige = {
					value = {
						value = minor_prestige_loss
						every_tributary = {
							limit = {
								obedience_target ?= root
								is_obedient = no
								ROOT = {
									is_character_interaction_potentially_accepted = {
										interaction = mpo_demand_obedience_interaction
										recipient = prev
									}
									NOT = { is_at_war_with = prev }
								}
							}
							add = 1
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				scope:mdo_tributary_accept ?= yes
			}
			every_tributary = {
				limit = {
					obedience_target ?= root
					is_obedient = no
					NOT = { is_at_war_with = prev }
				}
				custom_tooltip = mdo_demand_obedience_decion_sent
				run_interaction = {
					interaction = mpo_demand_obedience_interaction
					actor = root
					recipient = this
					send_threshold = accept
				}
			}
			show_as_tooltip = {
				add_prestige = {
					value = {
						value = minor_prestige_loss
						every_tributary = {
							limit = {
								obedience_target ?= root
								is_obedient = no
								ROOT = {
									is_character_interaction_potentially_accepted = {
										interaction = mpo_demand_obedience_interaction
										recipient = prev
										required_response = yes
									}
									NOT = { is_at_war_with = prev }
								}
							}
							add = 1
						}
					}
				}
			}
		}
	}
	ai_check_interval = 0
}

